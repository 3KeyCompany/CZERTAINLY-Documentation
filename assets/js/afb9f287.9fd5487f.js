"use strict";(self.webpackChunkczertainly=self.webpackChunkczertainly||[]).push([[9767],{3905:function(e,t,n){n.d(t,{Zo:function(){return p},kt:function(){return f}});var r=n(67294);function a(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function o(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,r)}return n}function i(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?o(Object(n),!0).forEach((function(t){a(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):o(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}function c(e,t){if(null==e)return{};var n,r,a=function(e,t){if(null==e)return{};var n,r,a={},o=Object.keys(e);for(r=0;r<o.length;r++)n=o[r],t.indexOf(n)>=0||(a[n]=e[n]);return a}(e,t);if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(e);for(r=0;r<o.length;r++)n=o[r],t.indexOf(n)>=0||Object.prototype.propertyIsEnumerable.call(e,n)&&(a[n]=e[n])}return a}var l=r.createContext({}),s=function(e){var t=r.useContext(l),n=t;return e&&(n="function"==typeof e?e(t):i(i({},t),e)),n},p=function(e){var t=s(e.components);return r.createElement(l.Provider,{value:t},e.children)},u={inlineCode:"code",wrapper:function(e){var t=e.children;return r.createElement(r.Fragment,{},t)}},d=r.forwardRef((function(e,t){var n=e.components,a=e.mdxType,o=e.originalType,l=e.parentName,p=c(e,["components","mdxType","originalType","parentName"]),d=s(n),f=a,m=d["".concat(l,".").concat(f)]||d[f]||u[f]||o;return n?r.createElement(m,i(i({ref:t},p),{},{components:n})):r.createElement(m,i({ref:t},p))}));function f(e,t){var n=arguments,a=t&&t.mdxType;if("string"==typeof e||a){var o=n.length,i=new Array(o);i[0]=d;var c={};for(var l in t)hasOwnProperty.call(t,l)&&(c[l]=t[l]);c.originalType=e,c.mdxType="string"==typeof e?e:a,i[1]=c;for(var s=2;s<o;s++)i[s]=n[s];return r.createElement.apply(null,i)}return r.createElement.apply(null,n)}d.displayName="MDXCreateElement"},64514:function(e,t,n){n.r(t),n.d(t,{assets:function(){return p},contentTitle:function(){return l},default:function(){return f},frontMatter:function(){return c},metadata:function(){return s},toc:function(){return u}});var r=n(83117),a=n(80102),o=(n(67294),n(3905)),i=["components"],c={},l="Certbot",s={unversionedId:"certificate-key/protocols/acme/certbot",id:"certificate-key/protocols/acme/certbot",title:"Certbot",description:"Certbot can be used to issue and manage the certificates on manually administered servers. It allows requesting and downloading certificate from ACME enabled servers.",source:"@site/docs/10-certificate-key/07-protocols/02-acme/13-certbot.md",sourceDirName:"10-certificate-key/07-protocols/02-acme",slug:"/certificate-key/protocols/acme/certbot",permalink:"/docs/certificate-key/protocols/acme/certbot",draft:!1,tags:[],version:"current",sidebarPosition:13,frontMatter:{},sidebar:"tutorialSidebar",previous:{title:"Kubernetes cert-manager",permalink:"/docs/certificate-key/protocols/acme/cert-manager"},next:{title:"IIS win-acme",permalink:"/docs/certificate-key/protocols/acme/win-acme"}},p={},u=[{value:"Prerequisites",id:"prerequisites",level:2},{value:"HTTP-01",id:"http-01",level:2},{value:"DNS-01",id:"dns-01",level:2},{value:"Revoke Certificate",id:"revoke-certificate",level:2}],d={toc:u};function f(e){var t=e.components,n=(0,a.Z)(e,i);return(0,o.kt)("wrapper",(0,r.Z)({},d,n,{components:t,mdxType:"MDXLayout"}),(0,o.kt)("h1",{id:"certbot"},"Certbot"),(0,o.kt)("p",null,(0,o.kt)("a",{parentName:"p",href:"https://certbot.eff.org/"},(0,o.kt)("inlineCode",{parentName:"a"},"Certbot"))," can be used to issue and manage the certificates on manually administered servers. It allows requesting and downloading certificate from ACME enabled servers."),(0,o.kt)("p",null,"For more information about ",(0,o.kt)("inlineCode",{parentName:"p"},"Certbot"),", refer to the ",(0,o.kt)("a",{parentName:"p",href:"https://eff-certbot.readthedocs.io/en/stable/"},"Certbot documentation"),"."),(0,o.kt)("p",null,"CZERTAINLY platform supports ACME implementation according to the ",(0,o.kt)("a",{parentName:"p",href:"https://datatracker.ietf.org/doc/html/rfc8555"},"RFC 8555"),". This guide shows, how you can use ",(0,o.kt)("inlineCode",{parentName:"p"},"Certbot")," to manage certificates using ACME protocol and certificate management services controlled by the platform."),(0,o.kt)("h2",{id:"prerequisites"},"Prerequisites"),(0,o.kt)("p",null,"Before configuring ",(0,o.kt)("inlineCode",{parentName:"p"},"Certbot")," with CZERTAINLY, you need to have the following:"),(0,o.kt)("ul",null,(0,o.kt)("li",{parentName:"ul"},"Certbot installed in the host server"),(0,o.kt)("li",{parentName:"ul"},"Configured at least one ",(0,o.kt)("inlineCode",{parentName:"li"},"RA Profile")," certificate service in CZERTAINLY"),(0,o.kt)("li",{parentName:"ul"},"Access to HTTP or DNS resources, that will be used to validate ACME challenges"),(0,o.kt)("li",{parentName:"ul"},"ACME protocol enabled according to the ",(0,o.kt)("a",{parentName:"li",href:"enable-acme"},"Enable ACME"))),(0,o.kt)("p",null,"To install ",(0,o.kt)("inlineCode",{parentName:"p"},"Certbot"),", follow the ",(0,o.kt)("a",{parentName:"p",href:"https://certbot.eff.org/"},"installation guide"),"."),(0,o.kt)("h2",{id:"http-01"},"HTTP-01"),(0,o.kt)("p",null,"Issuing certificate using ",(0,o.kt)("inlineCode",{parentName:"p"},"Certbot")," for is an easy step. ",(0,o.kt)("inlineCode",{parentName:"p"},"http-01")," challenge type is considered by default for the request. We are going to use ",(0,o.kt)("inlineCode",{parentName:"p"},"Apache")," HTTP server as an example of the web server for which we would like to manage SSL/TLS certificate using ",(0,o.kt)("inlineCode",{parentName:"p"},"Certbot"),"."),(0,o.kt)("p",null,"Once the ",(0,o.kt)("inlineCode",{parentName:"p"},"Apache")," server is ready, you can use the following command to request certificate:"),(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre",className:"language-bash"},"certbot -n --apache ** \\\n  -d www.example.com \\\n  --server https://[domain]:[port]/api/acme/raProfile/czertainly/directory\n")),(0,o.kt)("p",null,"In the example above, we are asking the ACME server represented by CZERTAINLY platform to issue SSL/TLS certificate for the domain ",(0,o.kt)("inlineCode",{parentName:"p"},"www.example.com"),". Once the certificate is successfully downloaded, ",(0,o.kt)("inlineCode",{parentName:"p"},"Certbot")," will automatically assign it to the ",(0,o.kt)("inlineCode",{parentName:"p"},"Apache")," configuration."),(0,o.kt)("p",null,"More command line options can be found in the ",(0,o.kt)("a",{parentName:"p",href:"https://eff-certbot.readthedocs.io/en/stable/using.html#certbot-command-line-options"},"Certbot documentation"),"."),(0,o.kt)("admonition",{type:"note"},(0,o.kt)("p",{parentName:"admonition"},"Note that URL of the server and host should be updated before running the previous command.")),(0,o.kt)("p",null,"The issued certificate is also included in the certificate inventory of the platform. From now on, the ",(0,o.kt)("inlineCode",{parentName:"p"},"Certbot")," will renew the certificate automatically."),(0,o.kt)("h2",{id:"dns-01"},"DNS-01"),(0,o.kt)("p",null,"To use ",(0,o.kt)("inlineCode",{parentName:"p"},"dns-01")," challenge type, ",(0,o.kt)("inlineCode",{parentName:"p"},"Certbot")," offers various DNS plugins based on the technology you would like to use. The list of DNS plugins supported by Certbot can be found at ",(0,o.kt)("a",{parentName:"p",href:"https://eff-certbot.readthedocs.io/en/stable/using.html#dns-plugins"},"DNS Plugins"),". In this example, we will see how to use ",(0,o.kt)("inlineCode",{parentName:"p"},"Certbot")," with ",(0,o.kt)("a",{parentName:"p",href:"https://www.isc.org/bind/"},"Bind9 DNS")," and ",(0,o.kt)("a",{parentName:"p",href:"https://certbot-dns-rfc2136.readthedocs.io/en/stable/"},(0,o.kt)("inlineCode",{parentName:"a"},"dns_rfc2136")," plugin"),"."),(0,o.kt)("admonition",{type:"note"},(0,o.kt)("p",{parentName:"admonition"},"The installation and configuration of the DNS resolver in out of scope of this guide. The dynamic DNS should support the configuration of so-called Transaction SIGnatures (TSIG) to sign the a request that is being sent to the DNS server. You can follow good tutorials with that topic:"),(0,o.kt)("ul",{parentName:"admonition"},(0,o.kt)("li",{parentName:"ul"},(0,o.kt)("a",{parentName:"li",href:"https://www.cyberciti.biz/faq/unix-linux-bind-named-configuring-tsig"},"Bind Security: Transaction Signatures (TSIG) Configuration")),(0,o.kt)("li",{parentName:"ul"},(0,o.kt)("a",{parentName:"li",href:"https://tomthorp.me/blog/using-tsig-enable-secure-zone-transfers-between-bind-9x-servers"},"Using TSIG to enable secure Zone Transfers between Bind 9.x servers")))),(0,o.kt)("p",null,"Let's create a file called ",(0,o.kt)("inlineCode",{parentName:"p"},"dns.ini")," and insert the configuration of our DNS resolver including the TSIG secret:"),(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre"},"dns_rfc2136_server = <your DNS resolver IP address>\ndns_rfc2136_port = <your DNS resolver port>>\ndns_rfc2136_name = example.com\ndns_rfc2136_secret = <your DNS TSIG secret>\ndns_rfc2136_algorithm = <algorithm for the signatures>\n")),(0,o.kt)("p",null,"Once the the ",(0,o.kt)("inlineCode",{parentName:"p"},"dns.ini")," is created, you can request the certificate with the ",(0,o.kt)("inlineCode",{parentName:"p"},"dns-01")," challenge type validation using the following command:"),(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre",className:"language-bash"},"certbot certonly -n \\\n  -d www.example.com \\\n  --dns-rfc2136 \\\n  --dns-rfc2136-credentials dns.ini \\\n  --server https://[domain]:[port]/api/acme/raProfile/czertainly/directory\n")),(0,o.kt)("p",null,"The issued certificate is also included in the certificate inventory of the platform. From now on, the ",(0,o.kt)("inlineCode",{parentName:"p"},"Certbot")," will renew the certificate automatically."),(0,o.kt)("h2",{id:"revoke-certificate"},"Revoke Certificate"),(0,o.kt)("p",null,"Certificate can be revoked using the ",(0,o.kt)("inlineCode",{parentName:"p"},"Certbot"),". To revoke certificate, run the following command:"),(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre",className:"language-bash"},"certbot revoke \\\n  --cert-name www.example.com  \\\n  --server https://[domain]:[port]/api/acme/raProfile/czertainly/directory\n")),(0,o.kt)("p",null,"You can check the certificate status also in the certificate inventory of the platform, after it was successfully revoked."))}f.isMDXComponent=!0}}]);